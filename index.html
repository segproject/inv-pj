<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üì¶ INV-PJ</title>
  <!-- Librer√≠as externas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
  <style>
    :root {
      --color-fondo: #fafbfd;
      --color-card: white;
      --color-primary: #4CAF50;
      --color-secondary: #607d8b;
      --color-texto: #333;
      --color-texto-secundario: #666;
      --borde-radius: 8px;
      --sombra: 0 2px 8px rgba(0,0,0,0.06);
      --btn-padding: 8px 12px;
      --btn-font-size: 14px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: var(--color-fondo);
      color: var(--color-texto);
      line-height: 1.5;
      font-size: 14px;
      padding: 12px;
    }
    .navbar {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .navbar button {
      background: var(--color-secondary);
      color: white;
      border: none;
      padding: var(--btn-padding);
      border-radius: var(--borde-radius);
      cursor: pointer;
      font-weight: 600;
      font-size: var(--btn-font-size);
      min-width: 100px;
      transition: all 0.2s ease;
    }
    .navbar button:hover { opacity: 0.9; }
    .navbar button.active {
      background: var(--color-primary);
      box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px;
      background: var(--color-card);
      border-radius: var(--borde-radius);
      box-shadow: var(--sombra);
      display: none;
    }
    .active-view { display: block !important; }
    h2 {
      margin-bottom: 12px;
      font-size: 1.4rem;
      font-weight: 700;
      text-align: center;
    }
    label {
      display: block;
      margin-top: 8px;
      font-weight: 600;
      font-size: 13px;
    }
    select, input {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    button {
      padding: var(--btn-padding);
      margin-top: 8px;
      background: var(--color-primary);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      font-size: var(--btn-font-size);
      min-height: 36px;
      transition: all 0.2s ease;
    }
    button:hover { background: #45a049; }
    button.secondary { background: #9e9e9e; }
    button.danger { background: #f44336; }
    button.impulsar { background: #ff9800; }
    button.export { background: #2196F3; }
    .tabla-wrapper {
      width: 100%;
      overflow-x: auto;
      margin-top: 12px;
      border-radius: var(--borde-radius);
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th, td {
      padding: 8px 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    th {
      background-color: #f8faf8;
      font-weight: 600;
      color: var(--color-secondary);
      font-size: 12px;
      position: sticky;
      top: 0;
    }
    .acciones button {
      padding: 4px 8px;
      margin: 0 2px;
      font-size: 16px;
      min-width: 32px;
      min-height: 32px;
      border-radius: 50%;
      transition: all 0.2s ease;
    }
    .form-section, .config-section {
      background: #f0f5f0;
      padding: 12px;
      border-radius: var(--borde-radius);
      margin-bottom: 16px;
      border: 1px solid #dfe8df;
    }
    .almacenes-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .almacenes-buttons button {
      margin-top: 0;
      padding: 6px 12px;
      font-size: 13px;
      min-height: auto;
      width: auto;
      flex: 1;
      max-width: 150px;
      border-radius: 4px;
    }
    .mensaje-vacio {
      text-align: center;
      color: var(--color-texto-secundario);
      padding: 16px;
      font-style: italic;
      font-size: 14px;
    }
    .cal-dia-vertical {
      position: relative;
      font-size: 13px;
      min-height: 60px;
      padding: 8px;
      border-radius: 4px;
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      margin-bottom: 8px;
      border: 1px solid #eee;
    }
    .cal-dia-vertical .cal-evento {
      background: rgba(76, 175, 80, 0.12);
      color: #2e7d32;
      padding: 2px 4px;
      margin: 2px 0;
      border-radius: 2px;
      font-size: 11px;
      display: block;
      word-break: break-word;
    }
    .cal-dia-vertical.cal-dia-hoy {
      border: 2px solid #4CAF50;
      font-weight: bold;
    }
    @media (max-width: 768px) {
      .ocultar-movil {
        display: none;
      }
      .navbar button {
        padding: 6px 8px;
        font-size: 12px;
        min-width: 80px;
      }
      .cal-dia-vertical {
        min-height: 50px;
        padding: 6px;
      }
    }
  </style>
</head>
<body>
<!-- (El resto del cuerpo del HTML es id√©ntico al original, con la √∫nica diferencia en las funciones renderizarTabla y renderizarTablaImpulsados que ya incluyen el estilo de resaltado en la fecha de vencimiento) -->
<div class="navbar">
  <button onclick="cambiarVista('calendario')" id="btnCalendario">üìÖ Calendario</button>
  <button onclick="cambiarVista('inventario')" id="btnInventario">üì¶ Inventario</button>
  <button onclick="cambiarVista('impulsados')" id="btnImpulsados">üéØ Por Impulsar</button>
  <button onclick="cambiarVista('configuraciones')" id="btnConfig">‚öôÔ∏è Configuraci√≥n</button>
</div>
<!-- === INVENTARIO === -->
<div id="vistaInventario" class="container">
  <h2 id="tituloForm">Registrar Insumo</h2>
  <div class="form-section" id="formSection">
    <form id="formulario">
      <input type="hidden" id="registroId" />
      <label for="categoria">Categor√≠a</label>
      <select id="categoria" required>
        <option value="">-- Seleccionar --</option>
        <option value="C√ÅRNICOS EN TROZOS Y RODAJAS">C√°rnicos</option>
        <option value="QUESOS">Quesos</option>
        <option value="FRUTAS Y VEGETALES">Frutas y Vegetales</option>
        <option value="SALSAS">Salsas</option>
        <option value="OTROS INSUMOS">Otros Insumos</option>
        <option value="PREPS">Preparaciones (PREPS)</option>
        <option value="OTRO">Otro (escribir)</option>
      </select>
      <label for="insumoSelect">Insumo</label>
      <select id="insumoSelect" style="display:none;"></select>
      <input type="text" id="insumoInput" placeholder="Nombre del insumo" style="display:none;" />
      <label for="etapa">Etapa</label>
      <select id="etapa" required>
        <option value="">-- Seleccionar --</option>
        <option value="RECIBIDO">Recibido</option>
        <option value="PREPARADO">Preparado</option>
        <option value="LINEA">En L√≠nea</option>
      </select>
      <label for="almacenamiento">Almacenamiento</label>
      <select id="almacenamiento"></select>
      <label for="fechaIngreso">F. Ingreso</label>
      <input type="date" id="fechaIngreso" required />
      <label for="fechaVencimientoManual">F. Venc. Manual (si aplica)</label>
      <input type="date" id="fechaVencimientoManual" />
      <label for="cantidad">Cant.</label>
      <input type="number" id="cantidad" min="0.1" step="0.1" required />
      <label for="unidad">U/M</label>
      <select id="unidad" required></select>
      <div style="display: flex; gap: 8px; margin-top: 12px;">
        <button type="button" onclick="guardarRegistro()">Guardar</button>
        <button type="button" onclick="limpiarFormularioCompleto()">Limpiar</button>
        <button type="button" onclick="cancelarEdicion()" id="btnCancelar" class="secondary" style="display:none;">Cancelar</button>
      </div>
    </form>
  </div>
  <!-- Botones de almacenes -->
  <div class="form-section">
    <div class="almacenes-buttons" id="botonesAlmacenes">
      <!-- Se llenar√° din√°micamente -->
    </div>
  </div>
  <div style="margin: 12px 0; display:flex; gap:8px; flex-wrap:wrap;">
    <button onclick="exportarPDF('inventario')" class="export">üìÑ PDF</button>
    <button onclick="exportarExcel('inventario')" class="export">xlsx</button>
  </div>
  <div class="tabla-wrapper">
    <table id="tablaInventario">
      <thead>
        <tr>
          <th>Insumo</th>
          <th class="ocultar-movil">Etapa</th>
          <th class="ocultar-movil">F. Ingreso</th>
          <th>F. Venc.</th>
          <th>Cant.</th>
          <th>U/M</th>
          <th class="ocultar-movil">Almac.</th>
          <th>D√≠as Rest.</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="cuerpoTabla"></tbody>
    </table>
  </div>
</div>
<!-- === POR IMPULSAR === -->
<div id="vistaImpulsados" class="container">
  <h2>üéØ Por Impulsar</h2>
  <div class="form-section" style="padding:8px;">
    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
      <button onclick="ordenarImpulsados('asc')" title="M√°s pr√≥ximos">üîº</button>
      <button onclick="ordenarImpulsados('desc')" title="M√°s lejanos">üîΩ</button>
    </div>
  </div>
  <div style="margin: 12px 0; display:flex; gap:8px; flex-wrap:wrap;">
    <button onclick="exportarPDF('impulsados')" class="export">üìÑ PDF</button>
    <button onclick="exportarExcel('impulsados')" class="export">xlsx</button>
  </div>
  <div class="tabla-wrapper">
    <table id="tablaImpulsados">
      <thead>
        <tr>
          <th>Insumo</th>
          <th>F. Venc.</th>
          <th>Cant.</th>
          <th>U/M</th>
          <th class="ocultar-movil">Almac.</th>
          <th>D√≠as Rest.</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="cuerpoTablaImpulsados"></tbody>
    </table>
  </div>
  <div id="mensajeVacioImpulsados" class="mensaje-vacio" style="display:none;">
    No hay insumos marcados para impulsar.
  </div>
</div>
<!-- === CALENDARIO SEMANAL VERTICAL === -->
<div id="vistaCalendario" class="container">
  <h2>üìÖ Calendario de Vencimientos</h2>
  <div style="margin-bottom: 12px; display: flex; align-items: center; justify-content: center; gap: 10px;">
    <button onclick="cambiarSemana(-1)" class="secondary">‚ùÆ Semana</button>
    <span id="tituloSemana" style="margin: 0 10px; font-weight: 600; font-size: 14px;"></span>
    <button onclick="cambiarSemana(1)" class="secondary">Semana ‚ùØ</button>
  </div>
  <div id="calendarioVertical"></div>
</div>
<!-- === CONFIGURACIONES === -->
<div id="vistaConfiguraciones" class="container">
  <h2>‚öôÔ∏è Configuraciones</h2>
  <div style="margin-bottom:16px; display:flex; gap:8px; flex-wrap:wrap;">
    <button onclick="exportarRespaldo()" class="export">üíæ Exportar Respaldo (.json)</button>
    <button onclick="document.getElementById('archivoRespaldo').click()" class="secondary">üì• Importar Respaldo (.json)</button>
    <input type="file" id="archivoRespaldo" accept=".json" style="display:none;" onchange="importarRespaldo(event)" />
  </div>
  <div class="config-section">
    <h3>Unidades de Medida</h3>
    <div style="display:flex; gap:8px; margin-top:8px;">
      <input type="text" id="nuevaUnidad" placeholder="Ej: caja, bandeja..." style="flex:1;" />
      <button type="button" onclick="agregarUnidad()" style="margin-top:0; padding:6px 12px; font-size:13px;">Agregar</button>
    </div>
    <div id="listaUnidades" style="margin-top:12px;"></div>
  </div>
  <div class="config-section">
    <h3>Lugares de Almacenamiento</h3>
    <div style="display:flex; gap:8px; margin-top:8px;">
      <input type="text" id="nuevoAlmacen" placeholder="Ej: Congelador 1..." style="flex:1;" />
      <button type="button" onclick="agregarAlmacenamiento()" style="margin-top:0; padding:6px 12px; font-size:13px;">Agregar</button>
    </div>
    <div id="listaAlmacenamientos" style="margin-top:12px;"></div>
  </div>
  <!-- SECCI√ìN DE COLUMNAS -->
  <div class="config-section">
    <h3>Columnas visibles en inventario</h3>
    <div id="columnasCheckboxes" style="margin-top:12px; display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 8px;"></div>
    <button onclick="guardarConfiguracionColumnas()" style="margin-top:12px; padding:6px 12px; font-size:13px;">üíæ Guardar configuraci√≥n</button>
  </div>
</div>
<script>
  // === LIBRER√çAS ===
  const { jsPDF } = window.jspdf;
  // === BASE DE DATOS FIJA (DATA MOD) ===
  const db = {
    "C√ÅRNICOS EN TROZOS Y RODAJAS": {
      "Alitas de pollo - local": { RECIBIDO: 7, PREPARADO: 7, LINEA: 1 },
      "Poppers de pollo": { RECIBIDO: 7, PREPARADO: 7, LINEA: 1 },
      "Pollo asado - importado": { RECIBIDO: 10, PREPARADO: 7, LINEA: 1 },
      "Salchicha italiana": { RECIBIDO: 12, PREPARADO: 7, LINEA: 1 },
      "Chorizo - local": { RECIBIDO: 7, PREPARADO: 4, LINEA: 1 },
      "Chorizo Parrillero": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 6, LINEA: 1 },
      "Carne de res - local": { RECIBIDO: 12, PREPARADO: 7, LINEA: 2 },
      "Salchicha de cerdo": { RECIBIDO: 12, PREPARADO: 7, LINEA: 2 },
      "Tocino": { RECIBIDO: 30, PREPARADO: 7, LINEA: 2 },
      "Pepperoni de cerdo": { RECIBIDO: 30, PREPARADO: 7, LINEA: 2 },
      "Jam√≥n - local": { RECIBIDO: 14, PREPARADO: 7, LINEA: 2 }
    },
    "QUESOS": {
      "Queso Mozzarella": { RECIBIDO: 14, PREPARADO: 7, LINEA: 1 },
      "Queso en tiras": { RECIBIDO: 14, PREPARADO: 7, LINEA: 1 },
      "Mezcla de 3 quesos (Asiago, Fontina, Provolone)": { RECIBIDO: 7, PREPARADO: 7, LINEA: 1 },
      "Mezcla de 2 quesos (Romano y Parmesano)": { RECIBIDO: 7, PREPARADO: 7, LINEA: 1 }
    },
    "FRUTAS Y VEGETALES": {
      "Champi√±√≥n": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 1, LINEA: "11:59 p. m." },
      "Cebolla blanca/roja": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 2, LINEA: "11:59 p. m." },
      "Pimiento rojo": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 2, LINEA: "11:59 p. m." },
      "Pimiento verde": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 2, LINEA: "11:59 p. m." },
      "Tomate": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 2, LINEA: "11:59 p. m." },
      "Jalape√±os": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 60, LINEA: "11:59 p. m." },
      "Aceituna negra": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 7, LINEA: 2 },
      "Aceituna verde": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 7, LINEA: 2 },
      "Pi√±a - lata": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 15, LINEA: 2 },
      "Pepperoncini": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 15, LINEA: "11:59 p. m." }
    },
    "SALSAS": {
      "Salsa pizza - lata": { RECIBIDO: "Seg√∫n empaque", PREPARADO: "10 horas", LINEA: "10 horas" },
      "Salsa de mayonesa con aj√≠ limo": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 7, LINEA: "11:59 p. m." },
      "Salsa rosada (1kg)": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 7, LINEA: "11:59 p. m." },
      "Salsa rosada (0.5 kg)": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 7, LINEA: "11:59 p. m." },
      "Salsa Parrillera": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 3, LINEA: "11:59 p. m." },
      "Salsa de ajo (botella - granel)": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 21, LINEA: "11:59 p. m." },
      "Salsa de mango habanero (bolsa)": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 7, LINEA: "11:59 p. m." },
      "Salsa Ranch": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 7, LINEA: "11:59 p. m." },
      "Salsa Bechamel": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 7, LINEA: "11:59 p. m." },
      "Salsa Chimichurri": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 15, LINEA: 2 },
      "Salsa de ajo (blister - cup)": { RECIBIDO: "Seg√∫n empaque", PREPARADO: "Seg√∫n empaque", LINEA: "11:59 p. m." },
      "Salsa Parmesana (botella - granel)": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 21, LINEA: "11:59 p. m." },
      "Salsa BBQ (blister - cup)": { RECIBIDO: "Seg√∫n empaque", PREPARADO: "Seg√∫n empaque", LINEA: "Seg√∫n empaque" },
      "Salsa BBQ (bolsa)": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 4, LINEA: 2 },
      "Salsa Buffalo (blister - cup)": { RECIBIDO: "Seg√∫n empaque", PREPARADO: "Seg√∫n empaque", LINEA: "Seg√∫n empaque" },
      "Salsa de Miel Picante": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 7, LINEA: "11:59 p. m." }
    },
    "OTROS INSUMOS": {
      "Dustinator": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 14, LINEA: 2 },
      "Masa Croisant": { RECIBIDO: 5, PREPARADO: null, LINEA: "11:59 p. m." },
      "Masa delgada - importada": { RECIBIDO: 30, PREPARADO: 3, LINEA: null },
      "Az√∫car glaseada (Icing) - local": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 30, LINEA: 2 },
      "Cinamon Spreed": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 30, LINEA: 2 },
      "Or√©gano - sachet": { RECIBIDO: "Seg√∫n empaque", PREPARADO: "Seg√∫n empaque", LINEA: "Seg√∫n empaque" },
      "Aji panca - sachet": { RECIBIDO: "Seg√∫n empaque", PREPARADO: "Seg√∫n empaque", LINEA: "Seg√∫n empaque" },
      "Or√©gano - granel": { RECIBIDO: "Seg√∫n empaque", PREPARADO: "Seg√∫n empaque", LINEA: "Seg√∫n empaque" },
      "Aji panca - granel": { RECIBIDO: "Seg√∫n empaque", PREPARADO: "Seg√∫n empaque", LINEA: "Seg√∫n empaque" },
      "Sazonador italiano": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 7, LINEA: 3 },
      "Pasta de lasagna": { RECIBIDO: 10, PREPARADO: 8, LINEA: null },
      "Tortilla": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 7, LINEA: "11:59 p. m." },
      "Manjar Blanco": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 15, LINEA: 5 },
      "Az√∫car Impalpable": { RECIBIDO: "Seg√∫n empaque", PREPARADO: 30, LINEA: 5 }
    },
    "PREPS": {
      "Lasagna (All the meats/The Works/Americana)": { RECIBIDO: null, PREPARADO: 4, LINEA: null },
      "Rollitos de Pepperoni/Jam√≥n": { RECIBIDO: null, PREPARADO: "6 horas", LINEA: "6 horas" },
      "Rollitos de Manjar": { RECIBIDO: null, PREPARADO: "6 horas", LINEA: "6 horas" },
      "Rollitos de Canela": { RECIBIDO: null, PREPARADO: "6 horas", LINEA: "6 horas" }
    }
  };
  // === FUNCIONES DE EXPORTACI√ìN ===
  function exportarPDF(tipo) {
    const elementId = tipo === 'inventario' ? 'tablaInventario' : 'tablaImpulsados';
    const titulo = tipo === 'inventario' ? 'Inventario de Insumos' : 'Insumos por Impulsar';
    const element = document.getElementById(elementId).cloneNode(true);
    const acciones = element.querySelectorAll('td:last-child, th:last-child');
    acciones.forEach(c => c.remove());
    const container = document.createElement('div');
    container.style.padding = '12px';
    container.innerHTML = `<h2 style="text-align:center; font-size:16px;">${titulo}</h2>`;
    container.appendChild(element);
    document.body.appendChild(container);
    container.style.position = 'absolute';
    container.style.left = '-9999px';
    html2canvas(container).then(canvas => {
      const imgData = canvas.toDataURL('image/png');
      const pdf = new jsPDF('landscape', 'mm', 'a4');
      const imgWidth = 297;
      const pageHeight = 210;
      const imgHeight = (canvas.height * imgWidth) / canvas.width;
      let heightLeft = imgHeight;
      let position = 0;
      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
      heightLeft -= pageHeight;
      while (heightLeft >= 0) {
        position = heightLeft - imgHeight;
        pdf.addPage();
        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
      }
      pdf.save(`${titulo.replace(/\s+/g, '_')}.pdf`);
      document.body.removeChild(container);
    });
  }
  function exportarExcel(tipo) {
    const elementId = tipo === 'inventario' ? 'tablaInventario' : 'tablaImpulsados';
    const table = document.getElementById(elementId).cloneNode(true);
    const acciones = table.querySelectorAll('td:last-child, th:last-child');
    acciones.forEach(c => c.remove());
    const ws = XLSX.utils.table_to_sheet(table);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Insumos");
    XLSX.writeFile(wb, `${tipo === 'inventario' ? 'Inventario' : 'Por_Impulsar'}.xlsx`);
  }
  function exportarRespaldo() {
    const data = {
      inventario: JSON.parse(localStorage.getItem("inventario")) || [],
      unidades: JSON.parse(localStorage.getItem("unidades")) || ["kg", "g", "unid", "lt", "ml", "paquete", "lata", "bolsa"],
      almacenes: JSON.parse(localStorage.getItem("almacenes")) || ["Congelador", "Refrigerado", "Seco", "En l√≠nea"],
      columnasVisibles: JSON.parse(localStorage.getItem("columnasVisibles")) || {
        insumo: true,
        etapa: true,
        fechaIngreso: true,
        fechaVencimiento: true,
        cantidad: true,
        unidad: true,
        almacenamiento: true,
        diasRestantes: true,
        acciones: true
      }
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `respaldo_vida_util_${new Date().toISOString().slice(0,10)}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
  function importarRespaldo(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        const data = JSON.parse(e.target.result);
        localStorage.setItem("inventario", JSON.stringify(data.inventario || []));
        localStorage.setItem("unidades", JSON.stringify(data.unidades || ["kg", "g", "unid", "lt", "ml", "paquete", "lata", "bolsa"]));
        localStorage.setItem("almacenes", JSON.stringify(data.almacenes || ["Congelador", "Refrigerado", "Seco", "En l√≠nea"]));
        localStorage.setItem("columnasVisibles", JSON.stringify(data.columnasVisibles || {}));
        alert("Respaldo importado correctamente. La p√°gina se recargar√°.");
        location.reload();
      } catch (err) {
        alert("Error al importar el archivo. Aseg√∫rese de que sea un respaldo v√°lido.");
      }
    };
    reader.readAsText(file);
    event.target.value = '';
  }
  // === FUNCIONES PRINCIPALES ===
  function cargarConfiguraciones() {
    const unidades = JSON.parse(localStorage.getItem("unidades")) || ["kg", "g", "unid", "lt", "ml", "paquete", "lata", "bolsa"];
    const almacenes = JSON.parse(localStorage.getItem("almacenes")) || ["Congelador", "Refrigerado", "Seco", "En l√≠nea"];
    const columnasVisibles = JSON.parse(localStorage.getItem("columnasVisibles")) || {
      insumo: true,
      etapa: true,
      fechaIngreso: true,
      fechaVencimiento: true,
      cantidad: true,
      unidad: true,
      almacenamiento: true,
      diasRestantes: true,
      acciones: true
    };
    localStorage.setItem("unidades", JSON.stringify(unidades));
    localStorage.setItem("almacenes", JSON.stringify(almacenes));
    localStorage.setItem("columnasVisibles", JSON.stringify(columnasVisibles));
    return { unidades, almacenes, columnasVisibles };
  }
  let config = cargarConfiguraciones();
  // ‚úÖ CORRECCI√ìN: Convertir fechas de string a Date al cargar
  let inventario = JSON.parse(localStorage.getItem("inventario")) || [];
  inventario = inventario.map(item => {
    if (item.fechaVencimiento && typeof item.fechaVencimiento === 'string') {
      const fechaV = new Date(item.fechaVencimiento);
      item.fechaVencimiento = isNaN(fechaV.getTime()) ? null : fechaV;
    }
    if (item.fechaIngreso && typeof item.fechaIngreso === 'string') {
      const fechaI = new Date(item.fechaIngreso);
      item.fechaIngreso = isNaN(fechaI.getTime()) ? null : fechaI;
    }
    return item;
  });
  let modoEdicion = false;
  let ordenInventario = 'asc';
  let ordenImpulsados = 'asc';
  // Formatear fecha como DD/MM/YYYY
  function formatearFecha(fecha) {
    if (!fecha) return "N/A";
    if (typeof fecha === 'string') {
      const [a, m, d] = fecha.split('-');
      return `${d}/${m}/${a}`;
    }
    if (fecha instanceof Date && !isNaN(fecha)) {
      const day = String(fecha.getDate()).padStart(2, '0');
      const month = String(fecha.getMonth() + 1).padStart(2, '0');
      const year = fecha.getFullYear();
      return `${day}/${month}/${year}`;
    }
    return "N/A";
  }
  // === CALENDARIO SEMANAL VERTICAL ===
  let fechaInicioSemana = new Date();
  fechaInicioSemana.setHours(0, 0, 0, 0);
  const diaHoy = fechaInicioSemana.getDay();
  const ajusteALunes = diaHoy === 0 ? -6 : 1 - diaHoy;
  fechaInicioSemana.setDate(fechaInicioSemana.getDate() + ajusteALunes);
  function obtenerRangoSemana(fechaLunes) {
    const inicio = new Date(fechaLunes);
    const fin = new Date(fechaLunes);
    fin.setDate(fin.getDate() + 6);
    const opts = { day: 'numeric', month: 'short' };
    const inicioStr = inicio.toLocaleDateString('es-PE', opts);
    const finStr = fin.toLocaleDateString('es-PE', opts);
    const anio = inicio.getFullYear();
    return `${inicioStr} ‚Äì ${finStr} ${anio}`;
  }
  function renderizarCalendario() {
    const titulo = document.getElementById("tituloSemana");
    titulo.textContent = obtenerRangoSemana(fechaInicioSemana);
    const porFecha = {};
    inventario.forEach(item => {
      if (item.fechaVencimiento) {
        const key = item.fechaVencimiento.toISOString().split('T')[0];
        if (!porFecha[key]) porFecha[key] = [];
        porFecha[key].push(item);
      }
    });
    const container = document.getElementById("calendarioVertical");
    container.innerHTML = "";
    const hoy = new Date();
    hoy.setHours(0, 0, 0, 0);
    for (let i = 0; i < 7; i++) {
      const fecha = new Date(fechaInicioSemana);
      fecha.setDate(fechaInicioSemana.getDate() + i);
      const esHoy = fecha.toDateString() === hoy.toDateString();
      const fechaKey = fecha.toISOString().split('T')[0];
      const tieneEventos = porFecha[fechaKey] && porFecha[fechaKey].length > 0;
      let eventosHtml = '';
      if (tieneEventos) {
        porFecha[fechaKey].forEach(item => {
          eventosHtml += `<div class="cal-evento" title="${item.insumo}">${item.insumo}</div>`;
        });
      }
      const estiloFondo = tieneEventos ? 'background: #f5f9f5;' : '';
      const diaCompleto = fecha.toLocaleDateString('es-PE', { weekday: 'long', day: 'numeric', month: 'long' });
      const diaElement = document.createElement('div');
      diaElement.className = `cal-dia-vertical ${esHoy ? 'cal-dia-hoy' : ''}`;
      diaElement.style.cssText = `${estiloFondo} padding: 8px; border-radius: 4px; background: white;`;
      diaElement.innerHTML = `
        <div style="font-weight: bold; margin-bottom: 4px; font-size:13px;">${diaCompleto}</div>
        ${eventosHtml || '<div style="color: #999; font-style: italic; font-size:11px;">Sin vencimientos</div>'}
      `;
      container.appendChild(diaElement);
    }
  }
  function cambiarSemana(delta) {
    const dias = delta * 7;
    fechaInicioSemana.setDate(fechaInicioSemana.getDate() + dias);
    renderizarCalendario();
  }
  // === Resto de funciones ===
  function calcularEstadoYDias(item) {
    const hoy = new Date();
    hoy.setHours(0, 0, 0, 0);
    let estado = "empaque";
    let diasRestantes = null;
    if (item.fechaVencimiento instanceof Date && !isNaN(item.fechaVencimiento)) {
      const diffTime = item.fechaVencimiento.getTime() - hoy.getTime();
      diasRestantes = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      if (diasRestantes > 0) estado = "ok";
      else if (diasRestantes === 0) estado = "hoy";
      else estado = "vencido";
    }
    return { estado, diasRestantes };
  }
  function cargarSelectsConfig() {
    const selUnidad = document.getElementById("unidad");
    const selAlmacen = document.getElementById("almacenamiento");
    selUnidad.innerHTML = '<option value="">-- Seleccionar --</option>';
    selAlmacen.innerHTML = '<option value="">-- Seleccionar --</option>';
    config.unidades.forEach(u => {
      const opt = document.createElement("option");
      opt.value = u;
      opt.textContent = u;
      selUnidad.appendChild(opt);
    });
    config.almacenes.forEach(a => {
      const opt = document.createElement("option");
      opt.value = a;
      opt.textContent = a;
      selAlmacen.appendChild(opt);
    });
  }
  function renderizarBotonesAlmacenes() {
    const contenedor = document.getElementById("botonesAlmacenes");
    contenedor.innerHTML = `<button class="secondary" onclick="filtrarPorAlmacen(null)">Mostrar todos</button>`;
    config.almacenes.forEach(almacen => {
      const btn = document.createElement("button");
      btn.textContent = almacen;
      btn.onclick = () => filtrarPorAlmacen(almacen);
      contenedor.appendChild(btn);
    });
  }
  let almacenFiltrado = null;
  function filtrarPorAlmacen(almacen) {
    almacenFiltrado = almacen;
    aplicarFiltros();
  }
  document.getElementById("categoria").addEventListener("change", function () {
    toggleInsumoInput();
    verificarMostrarFechaManual();
  });
  document.getElementById("insumoSelect").addEventListener("change", verificarMostrarFechaManual);
  document.getElementById("etapa").addEventListener("change", verificarMostrarFechaManual);
  function toggleInsumoInput() {
    const cat = document.getElementById("categoria").value;
    const select = document.getElementById("insumoSelect");
    const input = document.getElementById("insumoInput");
    select.innerHTML = '<option value="">-- Seleccionar --</option>';
    if (cat === "OTRO") {
      select.style.display = "none";
      input.style.display = "block";
      input.required = true;
      select.required = false;
    } else {
      input.style.display = "none";
      select.style.display = "block";
      input.required = false;
      select.required = true;
      select.disabled = !cat;
      if (cat && db[cat]) {
        Object.keys(db[cat]).forEach(nombre => {
          const opt = document.createElement("option");
          opt.value = nombre;
          opt.textContent = nombre;
          select.appendChild(opt);
        });
      }
    }
  }
  function verificarMostrarFechaManual() {
    const cat = document.getElementById("categoria").value;
    const insumo = cat === "OTRO" ? document.getElementById("insumoInput").value : document.getElementById("insumoSelect").value;
    const etapa = document.getElementById("etapa").value;
    let mostrar = false;
    if (cat === "OTRO") {
      mostrar = true;
    } else if (cat && insumo && etapa && db[cat] && db[cat][insumo]) {
      const vidaUtil = db[cat][insumo][etapa];
      if (vidaUtil === "Seg√∫n empaque" || vidaUtil === null || vidaUtil === undefined) {
        mostrar = true;
      }
    }
    document.getElementById("fechaVencimientoManual").style.display = mostrar ? "block" : "none";
  }
  function getInsumoValue() {
    return document.getElementById("categoria").value === "OTRO"
      ? document.getElementById("insumoInput").value.trim()
      : document.getElementById("insumoSelect").value;
  }
  function calcularFechaVencimiento(categoria, insumo, etapa, fechaIngresoStr, fechaManualStr) {
    if (fechaManualStr) {
      const [a, m, d] = fechaManualStr.split('-').map(Number);
      return new Date(a, m - 1, d);
    }
    if (categoria === "OTRO") return null;
    if (!db[categoria] || !db[categoria][insumo]) return null;
    const info = db[categoria][insumo];
    const vidaUtil = info[etapa];
    if (!vidaUtil || vidaUtil === "Seg√∫n empaque") return null;
    if (typeof vidaUtil === "string" && vidaUtil.includes("horas")) {
      const horas = parseInt(vidaUtil);
      const [a, m, d] = fechaIngresoStr.split('-').map(Number);
      const fecha = new Date(a, m - 1, d);
      fecha.setHours(fecha.getHours() + horas);
      return fecha;
    } else if (vidaUtil === "11:59 p. m.") {
      const [a, m, d] = fechaIngresoStr.split('-').map(Number);
      const fecha = new Date(a, m - 1, d);
      fecha.setHours(23, 59, 0, 0);
      return fecha;
    } else {
      const dias = parseInt(vidaUtil);
      const [a, m, d] = fechaIngresoStr.split('-').map(Number);
      const fecha = new Date(a, m - 1, d);
      fecha.setDate(fecha.getDate() + dias);
      return fecha;
    }
  }
  function limpiarFormularioCompleto() {
    document.getElementById("formulario").reset();
    document.getElementById("registroId").value = "";
    document.getElementById("tituloForm").textContent = "Registrar Insumo";
    document.getElementById("formSection").classList.remove("modo-edicion");
    document.getElementById("btnCancelar").style.display = "none";
    document.getElementById("insumoSelect").disabled = true;
    document.getElementById("fechaVencimientoManual").style.display = "none";
    cargarSelectsConfig();
  }
  function guardarRegistro() {
    const id = document.getElementById("registroId").value;
    const cat = document.getElementById("categoria").value;
    const insumo = getInsumoValue();
    const etapa = document.getElementById("etapa").value;
    const almacenamiento = document.getElementById("almacenamiento").value || "-";
    const fechaIngreso = document.getElementById("fechaIngreso").value;
    const fechaManual = document.getElementById("fechaVencimientoManual").value;
    const cantidad = parseFloat(document.getElementById("cantidad").value);
    const unidad = document.getElementById("unidad").value;
    if (!cat || !insumo || !etapa || !fechaIngreso || !cantidad || !unidad) {
      alert("Complete todos los campos obligatorios.");
      return;
    }
    const fechaVencimiento = calcularFechaVencimiento(cat, insumo, etapa, fechaIngreso, fechaManual);
    const registro = {
      id: modoEdicion && id ? parseInt(id) : Date.now(),
      categoria: cat,
      insumo,
      etapa,
      almacenamiento,
      fechaIngreso,
      fechaVencimiento,
      cantidad,
      unidad,
      fechaVencimientoManual: fechaManual || null,
      impulsado: false
    };
    if (modoEdicion && id) {
      const index = inventario.findIndex(item => item.id == id);
      if (index !== -1) inventario[index] = registro;
    } else {
      inventario.push(registro);
    }
    localStorage.setItem("inventario", JSON.stringify(inventario));
    renderizarVistas();
    limpiarFormularioCompleto();
  }
  function editarRegistro(id) {
    const item = inventario.find(i => i.id == id);
    if (!item) return;
    modoEdicion = true;
    document.getElementById("tituloForm").textContent = "Editar Insumo";
    document.getElementById("registroId").value = item.id;
    document.getElementById("formSection").classList.add("modo-edicion");
    document.getElementById("btnCancelar").style.display = "inline-block";
    document.getElementById("categoria").value = item.categoria;
    toggleInsumoInput();
    setTimeout(() => {
      if (item.categoria === "OTRO") {
        document.getElementById("insumoInput").value = item.insumo;
      } else {
        document.getElementById("insumoSelect").value = item.insumo;
      }
      document.getElementById("etapa").value = item.etapa;
      document.getElementById("almacenamiento").value = item.almacenamiento;
      document.getElementById("fechaIngreso").value = item.fechaIngreso;
      document.getElementById("fechaVencimientoManual").value = item.fechaVencimientoManual || "";
      document.getElementById("cantidad").value = item.cantidad;
      document.getElementById("unidad").value = item.unidad;
      verificarMostrarFechaManual();
    }, 20);
  }
  function cancelarEdicion() {
    limpiarFormularioCompleto();
  }
  function eliminarRegistro(id) {
    if (confirm("¬øEliminar este registro?")) {
      inventario = inventario.filter(item => item.id !== id);
      localStorage.setItem("inventario", JSON.stringify(inventario));
      renderizarVistas();
      limpiarFormularioCompleto();
    }
  }
  function impulsarInsumo(id) {
    const item = inventario.find(i => i.id == id);
    if (!item) return;
    item.impulsado = true;
    localStorage.setItem("inventario", JSON.stringify(inventario));
    renderizarTabla();
    renderizarTablaImpulsados();
    cambiarVista('impulsados');
  }
  function quitarDeImpulsados(id) {
    const item = inventario.find(i => i.id == id);
    if (item) {
      item.impulsado = false;
      localStorage.setItem("inventario", JSON.stringify(inventario));
      renderizarTablaImpulsados();
      renderizarTabla();
    }
  }
  function ordenarInventario(orden) {
    ordenInventario = orden;
    aplicarFiltros();
  }
  function ordenarImpulsados(orden) {
    ordenImpulsados = orden;
    renderizarTablaImpulsados();
  }
  function aplicarFiltros() {
    let filtrados = inventario;
    if (almacenFiltrado) {
      filtrados = inventario.filter(item => item.almacenamiento === almacenFiltrado);
    }
    renderizarTabla(filtrados);
  }
  function renderizarTabla(filtrados = null) {
    const data = filtrados !== null ? filtrados : inventario;
    const ordenados = [...data].sort((a, b) => {
      const fechaA = a.fechaVencimiento || new Date(8640000000000000);
      const fechaB = b.fechaVencimiento || new Date(8640000000000000);
      return ordenInventario === 'asc' ? fechaA - fechaB : fechaB - fechaA;
    });
    const tbody = document.getElementById("cuerpoTabla");
    tbody.innerHTML = "";
    const hoy = new Date();
    hoy.setHours(0, 0, 0, 0);
    ordenados.forEach(item => {
      let fechaVencimientoStr = "N/A";
      let claseEstado = "";
      let etiquetaManual = "";
      if (item.fechaVencimiento instanceof Date && !isNaN(item.fechaVencimiento)) {
        fechaVencimientoStr = formatearFecha(item.fechaVencimiento);
        if (item.fechaVencimientoManual) {
          etiquetaManual = ' <span class="manual-tag">üìÖ</span>';
        }
        const { estado } = calcularEstadoYDias(item);
        claseEstado = estado;
      }
      const etapaTexto = { RECIBIDO: "Recibido", PREPARADO: "Preparado", LINEA: "En L√≠nea" }[item.etapa] || item.etapa;
      const { diasRestantes } = calcularEstadoYDias(item);
      const diasTexto = diasRestantes !== null ? diasRestantes : "Empaque";
      const fila = document.createElement("tr");
      fila.innerHTML = `
        <td>${item.insumo}${item.impulsado ? ' <span style="color:#ff9800; font-size:12px;">üöÄ</span>' : ''}</td>
        <td class="ocultar-movil">${etapaTexto}</td>
        <td class="ocultar-movil">${formatearFecha(item.fechaIngreso)}</td>
        <td style="background-color: #fff8e1; font-weight: bold;">${fechaVencimientoStr}${etiquetaManual}</td>
        <td>${item.cantidad}</td>
        <td>${item.unidad}</td>
        <td class="ocultar-movil">${item.almacenamiento}</td>
        <td class="${claseEstado}">${diasTexto}</td>
        <td class="acciones">
          <button onclick="editarRegistro(${item.id})" title="Editar">‚úèÔ∏è</button>
          <button onclick="eliminarRegistro(${item.id})" class="danger" title="Eliminar">üóëÔ∏è</button>
          <button onclick="impulsarInsumo(${item.id})" class="impulsar" title="Impulsar">üöÄ</button>
        </td>
      `;
      tbody.appendChild(fila);
    });
    actualizarVisibilidadColumnas();
  }
  function renderizarTablaImpulsados() {
    const tbody = document.getElementById("cuerpoTablaImpulsados");
    const mensaje = document.getElementById("mensajeVacioImpulsados");
    tbody.innerHTML = "";
    let impulsados = inventario.filter(item => item.impulsado);
    impulsados = [...impulsados].sort((a, b) => {
      const fechaA = a.fechaVencimiento || new Date(8640000000000000);
      const fechaB = b.fechaVencimiento || new Date(8640000000000000);
      return ordenImpulsados === 'asc' ? fechaA - fechaB : fechaB - fechaA;
    });
    if (impulsados.length === 0) {
      mensaje.style.display = "block";
      return;
    }
    mensaje.style.display = "none";
    const hoy = new Date();
    hoy.setHours(0, 0, 0, 0);
    impulsados.forEach(item => {
      let fechaVencimientoStr = "N/A";
      let claseEstado = "";
      let etiquetaManual = "";
      if (item.fechaVencimiento instanceof Date && !isNaN(item.fechaVencimiento)) {
        fechaVencimientoStr = formatearFecha(item.fechaVencimiento);
        if (item.fechaVencimientoManual) {
          etiquetaManual = ' <span class="manual-tag">üìÖ</span>';
        }
        const { estado } = calcularEstadoYDias(item);
        claseEstado = estado;
      }
      const { diasRestantes } = calcularEstadoYDias(item);
      const diasTexto = diasRestantes !== null ? diasRestantes : "Empaque";
      const fila = document.createElement("tr");
      fila.innerHTML = `
        <td>${item.insumo}</td>
        <td style="background-color: #fff8e1; font-weight: bold;">${fechaVencimientoStr}${etiquetaManual}</td>
        <td>${item.cantidad}</td>
        <td>${item.unidad}</td>
        <td class="ocultar-movil">${item.almacenamiento}</td>
        <td class="${claseEstado}">${diasTexto}</td>
        <td class="acciones">
          <button onclick="quitarDeImpulsados(${item.id})" class="secondary" title="Quitar">‚Ü©Ô∏è</button>
        </td>
      `;
      tbody.appendChild(fila);
    });
  }
  // === CONFIGURACI√ìN DE COLUMNAS ===
  function renderizarConfiguracionColumnas() {
    const contenedor = document.getElementById("columnasCheckboxes");
    contenedor.innerHTML = "";
    const columnas = [
      { key: "insumo", label: "Insumo" },
      { key: "etapa", label: "Etapa" },
      { key: "fechaIngreso", label: "F. Ingreso" },
      { key: "fechaVencimiento", label: "F. Venc." },
      { key: "cantidad", label: "Cant." },
      { key: "unidad", label: "U/M" },
      { key: "almacenamiento", label: "Almac." },
      { key: "diasRestantes", label: "D√≠as Rest." },
      { key: "acciones", label: "Acciones" }
    ];
    columnas.forEach(col => {
      const div = document.createElement("div");
      div.innerHTML = `
        <label>
          <input type="checkbox" id="col_${col.key}" ${config.columnasVisibles[col.key] ? 'checked' : ''}>
          ${col.label}
        </label>
      `;
      contenedor.appendChild(div);
    });
  }
  function guardarConfiguracionColumnas() {
    const nuevas = {};
    [
      "insumo", "etapa", "fechaIngreso", "fechaVencimiento",
      "cantidad", "unidad", "almacenamiento", "diasRestantes", "acciones"
    ].forEach(key => {
      nuevas[key] = document.getElementById(`col_${key}`).checked;
    });
    config.columnasVisibles = nuevas;
    localStorage.setItem("columnasVisibles", JSON.stringify(nuevas));
    alert("Configuraci√≥n guardada.");
    actualizarVisibilidadColumnas();
  }
  function actualizarVisibilidadColumnas() {
    const col = config.columnasVisibles;
    const ths = document.querySelectorAll("#tablaInventario th");
    const tds = document.querySelectorAll("#tablaInventario td");
    // √çndices: 0=insumo, 1=etapa, 2=F.Ingreso, 3=F.Venc, 4=Cant, 5=U/M, 6=Almac, 7=D√≠as, 8=Acciones
    const visibilidad = [
      col.insumo,
      col.etapa,
      col.fechaIngreso,
      col.fechaVencimiento,
      col.cantidad,
      col.unidad,
      col.almacenamiento,
      col.diasRestantes,
      col.acciones
    ];
    ths.forEach((th, i) => {
      th.style.display = visibilidad[i] ? "table-cell" : "none";
    });
    const filas = document.querySelectorAll("#tablaInventario tbody tr");
    filas.forEach(fila => {
      const celdas = fila.querySelectorAll("td");
      celdas.forEach((td, i) => {
        td.style.display = visibilidad[i] ? "table-cell" : "none";
      });
    });
  }
  function renderizarConfiguraciones() {
    renderizarConfiguracionColumnas();
    const listaU = document.getElementById("listaUnidades");
    listaU.innerHTML = "";
    config.unidades.forEach((u, i) => {
      const div = document.createElement("div");
      div.style.display = "flex";
      div.style.justifyContent = "space-between";
      div.style.alignItems = "center";
      div.style.padding = "4px 0";
      div.innerHTML = `<span>${u}</span><button onclick="eliminarUnidad(${i})" class="danger" style="padding:2px 6px; font-size:12px;">Eliminar</button>`;
      listaU.appendChild(div);
    });
    const listaA = document.getElementById("listaAlmacenamientos");
    listaA.innerHTML = "";
    config.almacenes.forEach((a, i) => {
      const div = document.createElement("div");
      div.style.display = "flex";
      div.style.justifyContent = "space-between";
      div.style.alignItems = "center";
      div.style.padding = "4px 0";
      div.innerHTML = `<span>${a}</span><button onclick="eliminarAlmacenamiento(${i})" class="danger" style="padding:2px 6px; font-size:12px;">Eliminar</button>`;
      listaA.appendChild(div);
    });
  }
  function agregarUnidad() {
    const input = document.getElementById("nuevaUnidad");
    const valor = input.value.trim();
    if (valor && !config.unidades.includes(valor)) {
      config.unidades.push(valor);
      localStorage.setItem("unidades", JSON.stringify(config.unidades));
      renderizarConfiguraciones();
      input.value = "";
      cargarSelectsConfig();
    }
  }
  function eliminarUnidad(index) {
    if (confirm("¬øEliminar esta unidad?")) {
      config.unidades.splice(index, 1);
      localStorage.setItem("unidades", JSON.stringify(config.unidades));
      renderizarConfiguraciones();
      cargarSelectsConfig();
    }
  }
  function agregarAlmacenamiento() {
    const input = document.getElementById("nuevoAlmacen");
    const valor = input.value.trim();
    if (valor && !config.almacenes.includes(valor)) {
      config.almacenes.push(valor);
      localStorage.setItem("almacenes", JSON.stringify(config.almacenes));
      renderizarConfiguraciones();
      input.value = "";
      cargarSelectsConfig();
    }
  }
  function eliminarAlmacenamiento(index) {
    if (confirm("¬øEliminar este lugar?")) {
      config.almacenes.splice(index, 1);
      localStorage.setItem("almacenes", JSON.stringify(config.almacenes));
      renderizarConfiguraciones();
      cargarSelectsConfig();
    }
  }
  function renderizarVistas() {
    renderizarTabla();
    renderizarTablaImpulsados();
    renderizarCalendario();
    renderizarBotonesAlmacenes();
  }
  function cambiarVista(vista) {
    document.querySelectorAll(".container").forEach(el => el.classList.remove("active-view"));
    document.querySelectorAll(".navbar button").forEach(btn => btn.classList.remove("active"));
    if (vista === "calendario") {
      document.getElementById("vistaCalendario").classList.add("active-view");
      document.getElementById("btnCalendario").classList.add("active");
      renderizarCalendario();
    } else if (vista === "inventario") {
      document.getElementById("vistaInventario").classList.add("active-view");
      document.getElementById("btnInventario").classList.add("active");
      cargarSelectsConfig();
      renderizarBotonesAlmacenes();
    } else if (vista === "impulsados") {
      document.getElementById("vistaImpulsados").classList.add("active-view");
      document.getElementById("btnImpulsados").classList.add("active");
      renderizarTablaImpulsados();
    } else if (vista === "configuraciones") {
      document.getElementById("vistaConfiguraciones").classList.add("active-view");
      document.getElementById("btnConfig").classList.add("active");
      renderizarConfiguraciones();
    }
  }
  // Inicializar
  renderizarVistas();
  cambiarVista('calendario');
</script>
</body>
</html>
